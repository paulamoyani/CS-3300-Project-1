<html>
	<head>
		<title> World Leaders and their Social Media Accounts </title>
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
		<script src="http://d3js.org/topojson.v2.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.13.0/d3-legend.js"></script>
		<script src="js/functions.js" type="text/javascript"></script>
		<style>
			body {font-family: 'Alegreya Sans', Calibri, sans-serif; text-anchor: 'middle'; dominant-baseline: 'central';}
			.country[data-continent="North America"] { fill: #0067A5; }
			.country[data-continent="South America"] { fill: #E6E6FA; }
			.country[data-continent="Asia"] { fill: #E0FFFF; }
			.country[data-continent="Africa"] { fill: #90EE90; }
			.country[data-continent="Europe"] { fill: #FFE4B5; }
			.country[data-continent="Oceania"] { fill: 	#FFC0CB; }
			.country[data-continent="Antarctica"] { fill: #efc2c2; }

		</style>
	</head>

	<body>
		<h2>CS3300: Project 1</0h2> 
		<h3><u>Issues:</u> <br> 1) Pope not in 2/3 graphs (notice line doesn't end) <br> 
		2) Sheikh not in 2/3 graphs (no bubbles) <br> 
		3) lines not aligned <br>
		4) Text sometimes overlaps/hard to read.<br>
		5) Right side of map: 4 points; Right side of red graph: 1 point; Right side of blue graph: 3 points<br>
		</h3>

		<p id=“project1”> 
			<svg height="480" width="1000" id="mapView">
			</svg>
			<script type="text/javascript">
				var svg = d3.select(mapView);

				var width = svg.attr("width");
				var height = svg.attr("height");

				var projection = d3.geoEquirectangular().scale(75);
				var pathGenerator = d3.geoPath().projection(projection);

				var rawData;
				var countries;
				var socialMediaData;

				d3.json("data/Merged_Data_Feb21.json", function (error, data) {
					socialMediaData = data;
					var leadersWithFollowers = [];

					socialMediaData.forEach(function (d) {
						if (d.totalFollowers != 0) {
							capitalCityCoord = [d.capitalLongitude, d.capitalLatitude];
							leadersWithFollowers.push(capitalCityCoord);
						}
					});

					var longitudeExtent0 = d3.extent(socialMediaData, function (d) { 
						return d.capitalLongitude;
					});

					var longitudeScale0 = d3.scaleLinear()
					    .domain(longitudeExtent0)
					    .range([0, 1000]);

					//To create larger circles for top 10 leaders
					var followersScale = d3.scaleLinear()
				    	.domain([10021649, 98247052])
				    	.range([15, 50]);

					var specialCapitals = []
				    socialMediaData.forEach(function (d) {
						if (d.totalFollowers >= 10021649) {	
							specialCapitalCityCoord = [d.capitalLongitude, d.capitalLatitude, d.totalFollowers]
							specialCapitals.push(specialCapitalCityCoord)
						}
					});

				  	d3.json("data/world-50m.json", function (error, data) {
					  	rawData = data;  
					  	countries = topojson.feature(rawData, rawData.objects.countries); //change to continent
					  	showMap();
				  	});

					function showMap() {
				  		projection.fitExtent([[0,0], [width, height]], countries);
				  		pathGenerator = d3.geoPath().projection(projection);

				  		var paths = svg.selectAll("path.country")
				  			.data(countries.features)
				    	paths = paths.enter().append("path")
				    	.attr("class", "country")
							.attr("stroke", "#808080")
							.attr( "fill", "#C0C0C0")
				    		.merge(paths);  

				    	paths.attr("d", function(country) {
				     		return pathGenerator(country);
				    	})

				    	var circles = svg.selectAll("circle").data(leadersWithFollowers)

				    	circles = circles.enter().append("circle")
				    		.style("fill", "#FF4C4C")
				    		.style("opacity", 0.85)
				    		.merge(circles)
							.on("click", function(d) {
				  					console.log(d[0])
				  					console.log(d[1])
				  				});

				    	circles.attr("cx", function(d) {
				      		return projection(d)[0];
				   		})
				    	
				    	circles.attr("cy", function(d) {
				      		return projection(d)[1];
				      	})

				      	circles.attr("r", function(d) {
				    		return 3;
				   		})

				    //circles for top 10 leaders 
				   		var specialCircles = svg.selectAll("circle").data(specialCapitals);

				    	specialCircles = specialCircles.enter().append("circle")
				    		.style("fill", "#FF4C4C")
				    		.style("opacity", 0.85)
				    		.merge(specialCircles)
							.on("click", function(d) {
				  					console.log(d[0])
				  					console.log(d[1])
				  				});

				    	specialCircles
				    	.attr("cx", function(d) {
				          return projection(d)[0]; })
				    	.attr("cy", function(d) {
				      		return projection(d)[1]; })
						.attr("r", function(d) {
				    		return followersScale((d)[2]); })

				   	//lines for top 10 leaders
				   		var specialLines = svg.selectAll("line").data(specialCapitals)

				   		specialLines = specialLines.enter().append("line")
				    		.style("opacity", 0.3)
				    		.style("stroke-dasharray","5,5")
				    		.merge(specialLines);

				    	specialLines
				   		.attr("x1", function(d) {
				          return projection(d)[0]})
						.attr("y1", function(d) {
				          return projection(d)[1]})
						.attr("x2", function(d) {
				          return projection(d)[0]})
						.attr("y2",height)
						.style("stroke", "black");
					};
				});
			</script>

			<svg height="400" width="1000" id="graph1">
			</svg>
			<script type="text/javascript">
				var svg1 = d3.select("#graph1");

				var socialMediaData0;

				d3.json("data/Merged_Data_Feb21.json", function (error, data) {
					socialMediaData0 = data;
					
					var popExtent = d3.extent(socialMediaData0, function (d) { 
						return d.lgPop;
					});

					var popScale = d3.scaleLinear()
					.domain([5, 10])
					.range([360, 40]);

					var longitudeExtent = d3.extent(socialMediaData0, function (d) { 
						return d.capitalLongitude;
					});
					var longitudeScale = d3.scaleLinear()
					    .domain(longitudeExtent)
					    .range([0, 1000]);

					var popAxis = d3.axisLeft(popScale);
					svg1.append("g")
					.attr("transform", "translate(40, 0)")
					.call(popAxis);

					var longitudeAxis = d3.axisBottom(longitudeScale);
					svg1.append("g")
					.attr("transform", "translate(0, 360)")
					.call(longitudeAxis);

					var followersScale = d3.scaleLinear()
					.domain([10021649, 98247052])
					.range([15, 50]);

					var approvalExtent = d3.extent(socialMediaData0, function (d) { 
						return d.approvalRatings;
					});

					var approvalScale = d3.scaleLinear()
					.domain(approvalExtent)
					.range([0,1]);

					svg1.append("text")
						.attr("x", 500)
					    .attr("y", 390)
					    .style("font-family", "Palatino")
					    .style("font-size", "11px")
					    .style("alignment-baseline", "middle")
					    .style("text-anchor", "middle")
					    .text("Longitude");

					svg1.append("text")
					    .attr("x", 60)
					    .attr("y", 20)
					    .style("font-family", "Palatino")
					    .style("font-size", "11px")
					    .style("alignment-baseline", "middle")
					    .style("text-anchor", "middle")
					    .text("Population (Log Scale)");

					socialMediaData0.forEach(function (d) {
					    if (d.totalFollowers != 0) {
					        if (d.totalFollowers >= 10021649) { 
					            svg1.append("circle")
					           	.attr("cx", longitudeScale(d.capitalLongitude))
					            .attr("cy", popScale(d.lgPop))
					            .attr("r", followersScale(d.totalFollowers))
					            .style("fill", "#FF4C4C")
					            .style("opacity", approvalScale(d.approvalRatings));

					            svg1.append("text")
					            .attr("x", longitudeScale(d.capitalLongitude)+5)
					            .attr("y", popScale(d.lgPop)-0.8)
					            .style("font-family", "Palatino")
					            .style("font-size", "10px")
					            .style("alignment-baseline", "middle")
					            .text(d.worldLeader);

					            svg1.append("line")
					            .attr("x1",longitudeScale(d.capitalLongitude))
					            .attr("x2",longitudeScale(d.capitalLongitude))
					            .attr("y1",0)
					            .attr("y2",height)
					            .style("opacity", 0.3)
					            .style("stroke-dasharray","5,5")
					            .style("stroke", "black");
					        }
					        else {
					            svg1.append("circle")
					            .attr("cx", longitudeScale(d.capitalLongitude))
					            .attr("cy", popScale(d.lgPop))
					            .attr("r", 3)
					            .style("fill", "#FF4C4C")
					            .style("opacity", approvalScale(d.approvalRatings));
					        };
					    };
					});
				});

			</script>

			<svg height="400" width="1000" id="graph2">
			</svg>
			<script type="text/javascript">
				var svg2 = d3.select("#graph2");

				var socialMediaData1;

				d3.json("data/Merged_Data_Feb21.json", function (error, data) {
					socialMediaData1 = data;
					
					var age = d3.extent(socialMediaData1, function (d) { 
						return d.age;
					});

					//Statistics
					var ageMedian = median(age);
					var ageMax = Math.max.apply(null,age);
					var ageMin = Math.min.apply(null,age);

					var ageScale = d3.scaleLinear()
					.domain([0,ageMax])
					.range([360, 40]);

					var longitudeExtent1 = d3.extent(socialMediaData1, function (d) { 
						return d.capitalLongitude;
					});

					var longitudeScale1 = d3.scaleLinear()
					    .domain(longitudeExtent1)
					    .range([0, 1000]);

					var ageAxis = d3.axisLeft(ageScale);
					svg2.append("g")
					.attr("transform", "translate(40, 0)")
					.call(ageAxis);

					var longitudeAxis1 = d3.axisBottom(longitudeScale1);
					svg2.append("g")
					.attr("transform", "translate(0, 360)")
					.call(longitudeAxis1);

					var followersScale1 = d3.scaleLinear()
					.domain([10021649, 98247052])
					.range([15, 50]);

					var approvalExtent1 = d3.extent(socialMediaData1, function (d) { 
						return d.approvalRatings;
					});

					var approvalScale1 = d3.scaleLinear()
					.domain(approvalExtent1)
					.range([0,1]);

					svg2.append("text")
						.attr("x", 500)
					    .attr("y", 390)
					    .style("font-family", "Palatino")
					    .style("font-size", "11px")
					    .style("alignment-baseline", "middle")
					    .style("text-anchor", "middle")
					    .text("Longitude");

					svg2.append("text")
					    .attr("x", 40)
					    .attr("y", 20)
					    .style("font-family", "Palatino")
					    .style("font-size", "11px")
					    .style("alignment-baseline", "middle")
					    .style("text-anchor", "middle")
					    .text("Age");

					//Line for Median
					svg2.append("line")
					    .attr("x1",40)
					    .attr("x2",width)
					    .attr("y1",ageScale(ageMedian))
					    .attr("y2",ageScale(ageMedian))
					    .style("stroke", "green");
					//Text for Median
					svg2.append("text")
					    .attr("x", 80)
					    .attr("y", ageScale(ageMedian)-5)
					    .style("font-family", "Palatino")
					    .style("font-size", "11px")
					    .style("fill", "green")
					    .style("alignment-baseline", "middle")
					    .style("text-anchor", "middle")
					    .text("Median: " + ageMedian);

					//Line for Max Age
					svg2.append("line")
					    .attr("x1",40)
					    .attr("x2",width)
					    .attr("y1",ageScale(ageMax))
					    .attr("y2",ageScale(ageMax))
					    .style("stroke", "red");
					//Text for Max Age
					svg2.append("text")
					    .attr("x", 132)
					    .attr("y", ageScale(ageMax)-5)
					    .style("font-family", "Palatino")
					    .style("font-size", "11px")
					    .style("fill", "red")
					    .style("alignment-baseline", "middle")
					    .style("text-anchor", "middle")
					    .text("Max Age: " + ageMax + "(Queen Elizabeth II)");

					//Line for Min Age
					svg2.append("line")
					    .attr("x1",40)
					    .attr("x2",width)
					    .attr("y1",ageScale(ageMin))
					    .attr("y2",ageScale(ageMin))
					    .style("stroke", "orange");
					//Text for Min Age
					svg2.append("text")
					    .attr("x", 125)
					    .attr("y", ageScale(ageMin)-5)
					    .style("font-family", "Palatino")
					    .style("font-size", "11px")
					    .style("fill", "orange")
					    .style("alignment-baseline", "middle")
					    .style("text-anchor", "middle")
					    .text("Min Age: " + ageMin + "(Sebastian Kurz)");


					socialMediaData1.forEach(function (d) {
					    if (d.totalFollowers != 0) {
					        if (d.totalFollowers >= 10021649) { 
					            svg2.append("circle")
					           	.attr("cx", longitudeScale1(d.capitalLongitude))
					            .attr("cy", ageScale(d.age))
					            .attr("r", followersScale1(d.totalFollowers))
					            .style("fill", colorThirdGraph(d))
					            .style("opacity", approvalScale1(d.approvalRatings));

					            svg2.append("text")
					            .attr("x", longitudeScale1(d.capitalLongitude)+5)
					            .attr("y", ageScale(d.age)-0.8)
					            .style("font-family", "Palatino")
					            .style("font-size", "10px")
					            .style("alignment-baseline", "middle")
					            .text(d.worldLeader);

					            svg2.append("line")
					            .attr("x1",longitudeScale1(d.capitalLongitude))
					            .attr("x2",longitudeScale1(d.capitalLongitude))
					            .attr("y1",0)
					            .attr("y2",ageScale(d.age))
					            .style("opacity", 0.3)
					            .style("stroke-dasharray","5,5")
					            .style("stroke", "black");
					        }
					        else {
					            svg2.append("circle")
					            .attr("cx", longitudeScale1(d.capitalLongitude))
					            .attr("cy", ageScale(d.age))
					            .attr("r", 3)
					            .style("fill", colorThirdGraph(d))
					            .style("opacity", approvalScale1(d.approvalRatings));
					        };
					    };
					});
				});
			</script>

			<div id='stacked-bar'></div>
			<script type="text/javascript" id="graph3">
				d3.json("data/Merged_Data_Feb21.json", function (error, data) {
					socialMediaData2 = data;
					var top10Countries = [null];
					var Countries = d3.extent(socialMediaData2, function (d) { 
						if (d.totalFollowers != 0) {
							if (d.totalFollowers >= 10021649) { 
									top10Countries.push(d.country);
							}
						}
					});
					var totalFollowers = d3.extent(socialMediaData2, function (d) { 
						return d.totalFollowers;
					});
					var FacebookFollowers = d3.extent(socialMediaData2, function (d) { 
						return d.facebookLikes;
					});
					var TwitterFollowers = d3.extent(socialMediaData2, function (d) { 
						return d.twitterFollowers;
					});
					var InstagramFollowers = d3.extent(socialMediaData2, function (d) { 
						return d.instagramFollowers;
					});

					//Statistics of Followers
					var followersMax = Math.max.apply(null,totalFollowers);
					var followersMin = Math.min.apply(null,totalFollowers);


					var xData = ["Mexico", "United States", "Canada", "Argentina", "Vatican City", "Turkey", "Russia", "United Arab Emirates", "India", "Indonesia"];

					var dataByCountryStack = [
								[	
									{"x":0, "y0":0, "y":5540710}, //Mexico
									{"x":1, "y0":0, "y":23126205}, //Unites States
									{"x":2, "y0":0, "y":5554786+4135788+21877}, //Canada
									{"x":3, "y0":0, "y":4507652}, //Argentina
									{"x":4, "y0":0, "y":0}, //Vatican City
									{"x":5, "y0":0, "y":8941440+425125}, //Turkey
									{"x":6, "y0":0, "y":1443723}, //Russia
									{"x":7, "y0":0, "y":3770528}, //United Arab Emirates
									{"x":8, "y0":0, "y":4931867+43201619}, //India
									{"x":9, "y0":0, "y":8010255}, //Indonesia
								],
								[
									{"x":0, "y0":5540710, "y":7078859}, //Mexico
									{"x":1, "y0":23126205, "y":47801783}, //Unites States
									{"x":2, "y0":5554786+4135788+21877, "y":3970003+3471078+62959}, //Canada
									{"x":3, "y0":4507652, "y":4702549}, //Argentina
									{"x":4, "y0":0, "y":45248276}, //Vatican City
									{"x":5, "y0":8941440+425125, "y":12446840}, //Turkey
									{"x":6, "y0":1443723, "y":5467787}, //Russia
									{"x":7, "y0":3770528, "y":8697675}, //United Arab Emirates
									{"x":8, "y0":4931867+43201619, "y":40231657}, //India
									{"x":9, "y0":8010255, "y":9634150}, //Indonesia
								],
								[
									{"x":0, "y0":5540710+7078859, "y":310777}, //Mexico
									{"x":1, "y0":23126205+47801783, "y":8433374}, //Unites States
									{"x":2, "y0":5554786+4135788+21877+3970003+3471078+62959, "y":1976544+1326821}, //Canada
									{"x":3, "y0":4507652+4702549, "y":780507}, //Argentina
									{"x":4, "y0":0+45248276, "y":5255586}, //Vatican City
									{"x":5, "y0":8941440+425125+12446840, "y":3282239}, //Turkey
									{"x":6, "y0":1443723+5467787, "y":2933426}, //Russia
									{"x":7, "y0":3770528+8697675, "y":0}, //United Arab Emirates
									{"x":8, "y0":4931867+43201619+40231657, "y":11581545}, //India
									{"x":9, "y0":8010255+9634150, "y":7957893}, //Indonesia
								]
							];
					 
					var width = 1000;
					var height = 400;

					var svg3 = d3.select("body").append("svg")
					        .attr("width", width)
					        .attr("height", height)
					        .append("g")
					        .attr("transform", "translate(40,0)");
					 
					var colors = d3.scaleOrdinal().range(["#3b5998", "#1dcaff", "#cd486b"]);

					var yScale = d3.scaleLinear()
						.domain([0,d3.max(dataByCountryStack[dataByCountryStack.length - 1],function (d) { return d.y0 + d.y;})])
						.range([360, 40]);

					var yAxis = d3.axisLeft(yScale).tickFormat(function(d,i){ return Math.floor(d)/1000000 });
					svg3.append("g")
						.attr("transform", "translate(0, 0)")
						.call(yAxis);

					var xScale = d3.scaleLinear()
						.domain([-1,10])
						.range([0, 1000]);

					var xAxis = d3.axisBottom(xScale).tickValues([0,1,2,3,4,5,6,7,8,9,10])
						.tickFormat(function(d,i){ return xData[i] });
					svg3.append("g")
						.attr("transform", "translate(0, 360)")
						.call(xAxis);

					svg3.append("text")
						.attr("x", 20)
						.attr("y", 20)
						.style("font-family", "Palatino")
						.style("font-size", "11px")
						.style("alignment-baseline", "middle")
						.style("text-anchor", "middle")
						.text("Followers (in Millions)");

					svg3.append("text")
						.attr("x", 500)
						.attr("y", 390)
						.style("font-family", "Palatino")
						.style("font-size", "11px")
						.style("alignment-baseline", "middle")
						.style("text-anchor", "middle")
						.text("Country");
					 
					var layer = svg3.selectAll(".stack")
					        .data(dataByCountryStack)
					        .enter().append("g")
					        .attr("class", "stack")
					        .attr("fill", function(d, i) { return colors(i); });
					 
					layer.selectAll("rect")
					        .data(function (d) {
					        	console.log(d)
					            return d;
					        })
					        .enter().append("rect")
					        .attr("x", function (d) {
					            return xScale(d.x) - 40;
					        })
					        .attr("y", function (d) {
					            return yScale(d.y + d.y0);
					        })
					        .attr("height", function (d) {
					            return yScale(d.y0) - yScale(d.y + d.y0);
					        })
					        .attr("width", 80);

					var colorLegend = d3.legendColor()
				        .labelFormat(d3.format(".0f"))
				        .scale(colors)
				        .shapePadding(5)
				        .shapeWidth(50)
				        .shapeHeight(20)
				        .labelOffset(-100)
				        .labels(["Facebook", "Twitter", "Instagram"]);

				      svg3.append("g")
				        .attr("transform", "translate(60, 60)")
				        .attr("font-family", "Palatino")
				        .attr("font-size", 10)
				        .attr("id", "legend_4")
				        .call(colorLegend);
				});					

			</script>
		</p>
	</body>
</html>